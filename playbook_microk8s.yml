---
# ansible-playbook playbook_microk8s.yml

- hosts: microk8s
  gather_facts: yes
  become: yes

  vars:
    microk8s_version: "1.20/stable"
    # on Ubuntu focal, throws error on first run, so skipping
    microk8s_plugin_helm3_enable: false
    # false for virtualbox vm, where creating 'lo:microk8s' static IP will hang
    microk8s_plugin_host_access_enable: false
    # not a cluster
    microk8s_enabled_HA: false
    # configure this user's group, permissions, ~/.kube/config
    users: ['fabian']

    # for cert creation (role=selfsigned-cert-local)
    primary_domain: microk8s-1
    san_domains: ['microk8s-1-secondary','microk8s-1-tertiary']

  roles:
    #- role: ansible_role_microk8s
    #- role: microk8s-get-kubeconfig
    #- role: k9s
    #- role: kubectl-proxy
    #- role: kubernetes-dashboard
    #- role: istio-operator

    # ansible-galaxy collection install community.crypto
    #- role: selfsigned-cert-local
    #  delegate_to: localhost

    # simple hello world
    #- role: istio-helloworld

    - role: istio-gateway

