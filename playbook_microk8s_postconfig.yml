---

- hosts: microk8s
  gather_facts: yes
  become: yes

  # most vars are coming from 'group_vars/' directory
  vars:

  # these roles only need to be applied to first node in cluster
  roles:
    - wait-for-microk8s

    # assign additional IP, have metal LB use it
    - additional-netplan-ip
    - metallb-service

    # create CA and cert, apply to namespaces
    # also fetched locally to /tmp
    - cert-with-ca
    #- role: reapply-tls-secrets

    # fetch kubeconfig locally
    - microk8s-get-kubeconfig-local
    # apply tiny-tools daemonset to assist in troubleshooting
    - tiny-tools-all-nodes
