---

- hosts: microk8s
  gather_facts: yes
  become: yes

  # most vars are coming from 'group_vars/' directory
  vars:

  # these roles only need to be applied to first node in cluster
  roles:
    - role: wait-for-microk8s

    # assign additional IP, have metal LB use it
    - role: additional-netplan-ip
    - role: metallb-service

    # create CA and cert, apply to namespaces
    # also fetched locally to /tmp
    - role: cert-with-ca
    #- role: reapply-tls-secrets

    # fetch kubeconfig locally
    - role: microk8s-get-kubeconfig
    # apply tiny-tools daemonset to assist in troubleshooting
    - role: tiny-tools-all-nodes
