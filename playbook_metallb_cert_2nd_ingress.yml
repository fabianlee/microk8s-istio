---

- hosts: microk8s
  gather_facts: yes
  become: yes

  # most vars are coming from 'group_vars/' directory
  vars:

  # these roles only need to be applied to first node in cluster
  roles:
    - wait-for-microk8s

    # create custom CA and cert for TLS
    # certs also slurped locally to /tmp
    - cert-with-ca

    # assign additional IP, then have metalLB use them
    - additional-netplan-ip
    - metallb-service

    # microk8s 'ingress' add-on aleady creates primary nginx ingress controller
    # add a second one for use by the secondary metalLB IP
    # https://microk8s.io/docs/addon-ingress
    - add_secondary_ingress


